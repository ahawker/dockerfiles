# dockerfiles/bumpversion
#
# Dockerfile for https://github.com/peritus/bumpversion
ARG REPO
ARG BASE_IMAGE
ARG TAG=latest

FROM $REPO/$BASE_IMAGE:$TAG

ARG LABEL_PREFIX
ARG BUMPVERSION_VERSION
ARG ALPINE_GIT_PACKAGE_NAME
ARG ALPINE_GIT_PACKAGE_VERSION
ARG ALPINE_MERCURIAL_PACKAGE_NAME
ARG ALPINE_MERCURIAL_PACKAGE_VERSION

RUN test -n "$LABEL_PREFIX" && \
    test -n "$BUMPVERSION_VERSION" && \
    test -n "$ALPINE_GIT_PACKAGE_NAME" && \
    test -n "$ALPINE_GIT_PACKAGE_VERSION" && \
    test -n "$ALPINE_MERCURIAL_PACKAGE_NAME" && \
    test -n "$ALPINE_MERCURIAL_PACKAGE_VERSION"

LABEL $LABEL_PREFIX.bumpversion.version=$BUMPVERSION_VERSION

ENV BUMPVERSION_VERSION=$BUMPVERSION_VERSION

USER root

RUN apk add --no-cache \
    $ALPINE_GIT_PACKAGE_NAME="$ALPINE_GIT_PACKAGE_VERSION" \
    $ALPINE_MERCURIAL_PACKAGE_NAME="$ALPINE_MERCURIAL_PACKAGE_VERSION"

USER $USR

RUN pip install --user bumpversion==$BUMPVERSION_VERSION
