# dockerfiles/python/3
#
# Dockerfile for Python 3.
ARG REPO
ARG BASE_IMAGE
ARG TAG=latest

FROM $REPO/$BASE_IMAGE:$TAG

ARG LABEL_PREFIX
ARG PYTHON_VERSION
ARG ALPINE_PYTHON_PACKAGE_NAME
ARG ALPINE_PYTHON_PACKAGE_VERSION

RUN test -n "$LABEL_PREFIX" && \
    test -n "$PYTHON_VERSION" && \
    test -n "$ALPINE_PYTHON_PACKAGE_NAME" && \
    test -n "$ALPINE_PYTHON_PACKAGE_VERSION"

LABEL $LABEL_PREFIX.python.version=$PYTHON_VERSION \
      $LABEL_PREFIX.alpine.python.package.name=$ALPINE_PYTHON_PACKAGE_NAME \
      $LABEL_PREFIX.alpine.python.package.version=$ALPINE_PYTHON_PACKAGE_VERSION

ENV PYTHON_VERSION=$PYTHON_VERSION \
    ALPINE_PYTHON_PACKAGE_NAME=$ALPINE_PYTHON_PACKAGE_NAME \
    ALPINE_PYTHON_PACKAGE_VERSION=$ALPINE_PYTHON_PACKAGE_VERSION

USER root

RUN apk add --no-cache $ALPINE_PYTHON_PACKAGE_NAME="$ALPINE_PYTHON_PACKAGE_VERSION" && \
    pip3 install --no-cache-dir --upgrade pip

ENV PATH=$PATH:/home/$USER/.local/bin

USER $USER
