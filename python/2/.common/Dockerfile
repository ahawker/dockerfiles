# dockerfiles/python/2
#
# Dockerfile for Python 2.
ARG REPO
ARG BASE_IMAGE
ARG TAG=latest

FROM $REPO/$BASE_IMAGE:$TAG

ARG LABEL_PREFIX
ARG PYTHON_VERSION
ARG PYTHON_PIP_VERSION
ARG ALPINE_PYTHON_PACKAGE_NAME
ARG ALPINE_PYTHON_PACKAGE_VERSION

RUN test -n "$LABEL_PREFIX" && \
    test -n "$PYTHON_VERSION" && \
    test -n "$PYTHON_PIP_VERSION" && \
    test -n "$ALPINE_PYTHON_PACKAGE_NAME" && \
    test -n "$ALPINE_PYTHON_PACKAGE_VERSION"

LABEL $LABEL_PREFIX.python.version=$PYTHON_VERSION \
      $LABEL_PREFIX.pip.version=$PYTHON_PIP_VERSION \
      $LABEL_PREFIX.alpine.python.package.name=$ALPINE_PYTHON_PACKAGE_NAME \
      $LABEL_PREFIX.alpine.python.package.version=$ALPINE_PYTHON_PACKAGE_VERSION

ENV DOCKERFILES_PYTHON_VERSION=$PYTHON_VERSION \
    DOCKERFILES_PYTHON_PIP_VERSION=$PYTHON_PIP_VERSION \
    DOCKERFILES_ALPINE_PYTHON_PACKAGE_NAME=$ALPINE_PYTHON_PACKAGE_NAME \
    DOCKERFILES_ALPINE_PYTHON_PACKAGE_VERSION=$ALPINE_PYTHON_PACKAGE_VERSION

USER root

RUN apk add --no-cache $ALPINE_PYTHON_PACKAGE_NAME="$ALPINE_PYTHON_PACKAGE_VERSION" py-pip && \
    pip install --no-cache-dir --upgrade pip=="$PYTHON_PIP_VERSION"

ENV PATH=$PATH:/home/$DOCKERFILES_USR/.local/bin

USER $DOCKERFILES_USR
