# dockerfiles/jre
#
# Dockerfile for Java Runtime Environment (JRE).
ARG REPO
ARG BASE_IMAGE
ARG TAG=latest

FROM $REPO/$BASE_IMAGE:$TAG

ARG LABEL_PREFIX
ARG JAVA_VERSION
ARG JAVA_DOT_VERSION
ARG JAVA_MAJOR_VERSION
ARG JAVA_MINOR_VERSION
ARG ALPINE_JAVA_PACKAGE_NAME
ARG ALPINE_JAVA_PACKAGE_VERSION

RUN test -n "$LABEL_PREFIX" && \
    test -n "$JAVA_VERSION" && \
    test -n "$JAVA_DOT_VERSION" && \
    test -n "$JAVA_MAJOR_VERSION" && \
    test -n "$JAVA_MINOR_VERSION" && \
    test -n "$ALPINE_JAVA_PACKAGE_NAME" && \
    test -n "$ALPINE_JAVA_PACKAGE_VERSION"

LABEL $LABEL_PREFIX.java.version=$JAVA_VERSION \
      $LABEL_PREFIX.java.version.dot=$JAVA_DOT_VERSION \
      $LABEL_PREFIX.java.version.major=$JAVA_MAJOR_VERSION \
      $LABEL_PREFIX.java.version.minor=$JAVA_MINOR_VERSION \
      $LABEL_PREFIX.alpine.java.package.name=$ALPINE_JAVA_PACKAGE_NAME \
      $LABEL_PREFIX.alpine.java.package.version=$ALPINE_JAVA_PACKAGE_VERSION

ENV DOCKERFILES_JAVA_VERSION=$JAVA_VERSION \
    DOCKERFILES_JAVA_DOT_VERSION=$JAVA_DOT_VERSION \
    DOCKERFILES_JAVA_MAJOR_VERSION=$JAVA_MAJOR_VERSION \
    DOCKERFILES_JAVA_MINOR_VERSION=$JAVA_MINOR_VERSION \
    DOCKERFILES_ALPINE_JAVA_PACKAGE_NAME=$ALPINE_JAVA_PACKAGE_NAME \
    DOCKERFILES_ALPINE_JAVA_PACKAGE_VERSION=$ALPINE_JAVA_PACKAGE_VERSION \
    JAVA_HOME=/usr/lib/jvm/java-$DOCKERFILES_JAVA_MAJOR_VERSION.$DOCKERFILES_JAVA_MINOR_VERSION-openjdk/jre \
    OPENJDK_HOME=/usr/lib/jvm/java-$DOCKERFILES_JAVA_MAJOR_VERSION.$DOCKERFILES_JAVA_MINOR_VERSION-openjdk

ENV PATH=$PATH:$OPENJDK_HOME/jre/bin:$OPENJDK_HOME/bin

USER root

RUN apk add --no-cache $DOCKERFILES_ALPINE_JAVA_PACKAGE_NAME="$DOCKERFILES_ALPINE_JAVA_PACKAGE_VERSION"

USER $DOCKERFILES_USR
